<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Ultimate Daily Game Collection</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/02_active/images/2025-12-25_RDataSquared_Logo-removebg-preview.png">

  <style>
    /* =========================================================
       THEME TOKENS (Light default)
       ========================================================= */
    :root{
      --bg:#f5f5f5;
      --text:#1f2937;
      --muted:#6b7280;

      --card:#ffffff;
      --shadow:0 10px 24px rgba(0,0,0,.10);
      --border:#e5e7eb;

      --gold:#d4a017;
      --gold2:#b88910;

      --chip:#3f3f3f;
      --chipHover:#4a4a4a;
      --chipBorder:rgba(255,255,255,.08);

      --controlBg:#ffffff;
      --controlText:#111827;
      --controlBorder:#e5e7eb;

      --complete1:#18a999;
      --complete2:#0f7b6d;

      --radius:16px;
      --focus: rgba(212,160,23,.55);
      --toastBg: rgba(17,24,39,.92);
    }

    /* =========================================================
       DARK THEME OVERRIDES
       ========================================================= */
    html[data-theme="dark"]{
      --bg:#0b1220;
      --text:#e5e7eb;
      --muted:#a7b0bf;

      --card:#0f1a2e;
      --shadow:0 12px 28px rgba(0,0,0,.45);
      --border: rgba(255,255,255,.10);

      --gold:#d4a017;
      --gold2:#b88910;

      --chip:#1f2937;
      --chipHover:#243044;
      --chipBorder:rgba(255,255,255,.10);

      --controlBg:#0b162a;
      --controlText:#e5e7eb;
      --controlBorder: rgba(255,255,255,.12);

      --complete1:#16b6a4;
      --complete2:#0d7f72;

      --focus: rgba(212,160,23,.65);
      --toastBg: rgba(0,0,0,.85);
    }

    @media (prefers-color-scheme: dark) {
      html:not([data-theme]) { color-scheme: dark; }
    }

    /* =========================================================
       BASE
       ========================================================= */
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      padding:42px 16px 18px;
      text-align:center;
    }
    h1{
      margin:0 0 10px;
      font-size: clamp(32px, 4vw, 54px);
      letter-spacing:.3px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size: 15px;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding: 0 14px 60px;
    }

    /* =========================================================
       SECTIONS
       ========================================================= */
    .section{
      background:var(--card);
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      padding: 22px 22px 26px;
      margin: 18px 0;
      border: 1px solid var(--border);
    }
    .sectionHeader{
      display:flex;
      align-items:center;
      gap:12px;
      padding: 8px 2px 14px;
      border-bottom: 2px solid rgba(212,160,23,.55);
      margin-bottom: 18px;
    }
    .icon{
      width:22px;height:22px;display:inline-flex;
      align-items:center;justify-content:center;
      color:var(--gold2);
      flex: 0 0 auto;
    }
    .sectionTitle{
      font-size: 26px;
      margin:0;
    }

    /* =========================================================
       TOOLBAR
       ========================================================= */
    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin: 8px 0 18px;
    }
    .search{
      flex: 1 1 280px;
      position:relative;
      min-width: 220px;
    }
    .search input{
      width:100%;
      padding:12px 12px 12px 40px;
      border-radius: 12px;
      border:1px solid var(--controlBorder);
      outline:none;
      background:var(--controlBg);
      color: var(--controlText);
      font-size:14px;
    }
    .search input::placeholder{ color: color-mix(in oklab, var(--muted) 80%, transparent); }
    .search svg{
      position:absolute; left:12px; top:50%;
      transform:translateY(-50%);
      width:18px;height:18px;
      color: color-mix(in oklab, var(--muted) 85%, transparent);
      pointer-events:none;
    }

    .actions{
      display:flex;
      gap:10px;
      flex: 0 1 auto;
      align-items:center;
    }
    .btn{
      border:1px solid var(--controlBorder);
      background:var(--controlBg);
      color:var(--controlText);
      padding:10px 12px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      display:inline-flex;
      gap:8px;
      align-items:center;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ background: color-mix(in oklab, var(--controlBg) 88%, white); border-color: color-mix(in oklab, var(--controlBorder) 70%, white); }
    html[data-theme="dark"] .btn:hover{ background: color-mix(in oklab, var(--controlBg) 88%, black); border-color: color-mix(in oklab, var(--controlBorder) 70%, white); }
    .btn:active{ transform: translateY(1px); }
    .btnDanger{
      border-color: rgba(239,68,68,.35);
      color:#ef4444;
    }
    .btnDanger:hover{ background: rgba(239,68,68,.08); }

    .btnIcon{
      width: 44px;
      height: 44px;
      padding: 0;
      justify-content:center;
      border-radius: 12px;
      font-size: 18px;
    }

    /* =========================================================
       GRID + CARDS
       ========================================================= */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px 16px;
    }
    @media (max-width:720px){
      .grid{ grid-template-columns: 1fr; }
    }

    .gameCard{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 16px 16px;
      border-radius: 14px;
      background: linear-gradient(180deg, var(--chip), color-mix(in oklab, var(--chip) 80%, black));
      color:#fff;
      min-height:64px;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
      transition: transform .12s ease, filter .12s ease;
      border: 1px solid var(--chipBorder);
      cursor:pointer;
      user-select:none;
      outline:none;
    }
    .gameCard:hover{
      transform: translateY(-1px);
      filter: brightness(1.02);
      background: linear-gradient(180deg, var(--chipHover), color-mix(in oklab, var(--chipHover) 80%, black));
    }
    .gameCard:focus-visible{
      box-shadow: 0 0 0 3px var(--focus), 0 8px 18px rgba(0,0,0,.18);
    }

    .gameCard.starredCard{
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      border-color: rgba(255,255,255,.25);
    }

    .gameCard.completedCard{
      background: linear-gradient(180deg, var(--complete1), var(--complete2));
      border-color: rgba(255,255,255,.22);
    }

    .left{
      display:flex;
      flex-direction:column;
      gap:3px;
      min-width: 0;
      flex: 1 1 auto;
    }
    .nameRow{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
      flex-wrap:wrap;
    }
    .gameName{
      font-size: 16px;
      font-weight:700;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width:0;
    }
    .tag{
      font-size: 11px;
      color: rgba(255,255,255,.85);
      background: rgba(0,0,0,.18);
      padding: 4px 8px;
      border-radius: 999px;
      flex: 0 0 auto;
      line-height: 1;
    }
    .desc{
      font-size: 12px;
      color: rgba(255,255,255,.88);
      opacity:.92;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 46ch;
    }

    .right{
      display:flex;
      align-items:center;
      gap:8px;
      flex: 0 0 auto;
    }

    .iconBtn{
      width:38px;height:38px;
      border-radius: 11px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.14);
      cursor:pointer;
      transition: transform .06s ease, background .12s ease, border-color .12s ease;
      color:#fff;
      font-size: 18px;
      line-height: 1;
      user-select:none;
    }
    .iconBtn:hover{
      background: rgba(0,0,0,.22);
      border-color: rgba(255,255,255,.28);
    }
    .iconBtn:active{ transform: translateY(1px); }
    .iconBtn.starred{
      color: #ffd34a;
      text-shadow: 0 0 10px rgba(255,211,74,.35);
    }

    .empty{
      color: var(--muted);
      font-size:14px;
      padding: 10px 2px 0;
      display:none;
    }
    .hint{
      color: var(--muted);
      font-size: 13px;
      margin: 10px 0 0;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      background: var(--toastBg);
      color:#fff;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      display:none;
      gap:8px;
      align-items:center;
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
      z-index: 50;
      max-width: calc(100vw - 24px);
    }
    .toast.show{ display:flex; }
    .toast svg{ width:16px;height:16px; opacity:.9; }

    /* =========================================================
       COMPLETED (COLLAPSIBLE) â€” prettier dropdown
       ========================================================= */
    details.sectionDetails{
      margin: 18px 0;
    }
    details.sectionDetails > summary{
      list-style:none;
      cursor:pointer;
      outline:none;
    }
    details.sectionDetails > summary::-webkit-details-marker{ display:none; }

    .summaryInner{
      position: relative;
      display:flex;
      align-items:center;
      gap:12px;
      padding: 18px 18px;
      background:
        radial-gradient(1200px 240px at 20% -40%, rgba(212,160,23,.22), transparent 60%),
        radial-gradient(1200px 240px at 80% 140%, rgba(24,169,153,.18), transparent 60%),
        var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: transform .10s ease, border-color .14s ease, box-shadow .14s ease;
      user-select:none;
    }
    summary:hover .summaryInner{
      transform: translateY(-1px);
      border-color: color-mix(in oklab, var(--border) 60%, var(--gold) 40%);
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
    }
    summary:focus-visible .summaryInner{
      box-shadow: 0 0 0 3px var(--focus), var(--shadow);
    }

    .summaryTitle{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
      flex: 1 1 auto;
    }
    .summaryTitle h2{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
      background: color-mix(in oklab, var(--controlBg) 80%, transparent);
      color: var(--muted);
      font-size: 13px;
      line-height: 1;
      white-space:nowrap;
    }

    .summaryMeta{
      display:flex;
      align-items:center;
      gap:10px;
      flex: 0 0 auto;
      color: var(--muted);
      font-size: 14px;
    }

    .resetBtn{
      border:1px solid rgba(239,68,68,.35);
      background: color-mix(in oklab, var(--controlBg) 92%, transparent);
      color:#ef4444;
      padding:8px 10px;
      border-radius: 12px;
      font-size: 13px;
      cursor:pointer;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .resetBtn:hover{ background: rgba(239,68,68,.08); border-color: rgba(239,68,68,.55); }
    .resetBtn:active{ transform: translateY(1px); }

    .chev{
      width:36px;height:36px;
      border-radius: 14px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border: 1px solid var(--controlBorder);
      background: var(--controlBg);
      color: var(--controlText);
      transition: transform .14s ease;
      flex: 0 0 auto;
    }
    .chev svg{ width:18px; height:18px; }
    details.sectionDetails[open] .chev{ transform: rotate(180deg); }

    .detailsBody{
      margin-top: 10px;
    }

    /* =========================================================
       MOBILE FRIENDLY IMPROVEMENTS
       ========================================================= */
    @media (max-width: 720px) {
      header{ padding: 28px 14px 10px; }
      h1{
        font-size: clamp(26px, 7vw, 40px);
        line-height: 1.1;
      }

      .wrap{ padding: 0 12px 44px; }

      .section{
        padding: 16px 14px 18px;
        margin: 14px 0;
        border-radius: 14px;
      }

      .sectionTitle{ font-size: 22px; }

      .toolbar{
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
        margin: 6px 0 14px;
        justify-content: flex-start;
      }

      .search{
        min-width: 0;
        flex: 0 0 auto;
      }

      .actions{
        display:grid;
        grid-template-columns: 1fr 1fr 44px;
        gap:10px;
        width:100%;
      }
      .btn{ justify-content:center; padding:12px 12px; }

      .gameCard{ padding: 14px 14px; gap: 10px; }

      .gameName{
        white-space: normal;
        overflow: visible;
        text-overflow: clip;
      }
      .desc{
        white-space: normal;
        overflow: visible;
        text-overflow: clip;
        max-width: none;
        line-height: 1.25;
      }

      .iconBtn{
        width: 44px;
        height: 44px;
        font-size: 20px;
      }

      .summaryInner{
        padding: 14px 14px;
        border-radius: 14px;
        gap: 10px;
        flex-wrap: wrap;
      }
      .summaryTitle h2{ font-size: 20px; }
      .summaryMeta{
        width:100%;
        justify-content: space-between;
      }
      .chev{ margin-left:auto; }
    }

    @media (max-width: 420px) {
      .actions{ grid-template-columns: 1fr 1fr; }
      .btnIcon{
        grid-column: 1 / -1;
        width: 100%;
      }
      .resetBtn{ width: 100%; justify-content:center; }
    }

    /* =========================================================
       FOOTER (VERSION)
       ========================================================= */
    footer{
      max-width:980px;
      margin: 0 auto;
      padding: 0 14px 22px;
      color: var(--muted);
      font-size: 12px;
      text-align: center;
      opacity: .9;
    }
    .versionBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: color-mix(in oklab, var(--card) 85%, transparent);
    }
    .dot{
      width:8px;
      height:8px;
      border-radius:999px;
      background: var(--gold2);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--gold2) 20%, transparent);
    }
  </style>
</head>

<body>
  <header>
    <h1>The Ultimate Daily Game Collection</h1>
    <p class="subtitle">Star your favorites to keep them handy (saved only on your device)</p>
  </header>

  <div class="wrap">
    <div class="toolbar">
      <div class="search">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
          <path d="M16.5 16.5 21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="searchInput" type="search" placeholder="Search gamesâ€¦" autocomplete="off" />
      </div>

      <div class="actions">
        <button class="btn" id="exportBtn" title="Copy starred list to clipboard">
          <span>Export stars</span>
        </button>
        <button class="btn btnDanger" id="clearStarsBtn" title="Remove all stars (only for you)">
          <span>Clear stars</span>
        </button>

        <button class="btn btnIcon" id="themeToggle" title="Toggle light/dark mode" aria-label="Toggle light/dark mode">
          <span id="themeIcon" aria-hidden="true">ðŸŒ™</span>
        </button>
      </div>
    </div>

    <div id="sections"></div>

    <p class="hint">
      ðŸ’¡ Tip: Click a card to open the game (always opens in a new tab). Stars, completions, last-played, and theme save only on your device.
    </p>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span id="toastText">Saved</span>
  </div>

  <!-- âœ… Version footer -->
  <footer>
    <span class="versionBadge">
      <span class="dot" aria-hidden="true"></span>
      <span id="versionText">Version</span>
    </span>
  </footer>

  <script>
    /***********************
     * VERSION
     * Change this whenever you ship an update
     ***********************/
    const VERSION = "v1.0.0";

    /***********************
     * CONFIG
     ***********************/
    const SHOW_STARRED_SECTION = true;

    /***********************
     * 0) COOKIES (theme)
     ***********************/
    const THEME_COOKIE = "rd2_theme"; // "light" | "dark"

    function setCookie(name, value, days = 365) {
      const date = new Date();
      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
      const expires = "expires=" + date.toUTCString();
      document.cookie = `${name}=${encodeURIComponent(value)}; ${expires}; path=/; SameSite=Lax`;
    }

    function getCookie(name) {
      const key = name + "=";
      const parts = document.cookie.split(";").map(s => s.trim());
      for (const p of parts) {
        if (p.startsWith(key)) return decodeURIComponent(p.substring(key.length));
      }
      return null;
    }

    function getPreferredTheme() {
      const cookieTheme = getCookie(THEME_COOKIE);
      if (cookieTheme === "light" || cookieTheme === "dark") return cookieTheme;
      return window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
    }

    function applyTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      const icon = document.getElementById("themeIcon");
      if (icon) icon.textContent = theme === "dark" ? "ðŸŒ™" : "â˜€ï¸";
    }

    /***********************
     * 1) EDIT YOUR GAMES
     ***********************/
    const GAMES = [
      { id: "moviedle", name: "Moviedle", url: "https://pix-media.com/games/moviedle", desc: "Can you name the movie in 6 seconds or less?", tags: ["Daily"] },
      { id: "moviedle2", name: "Moviedle 2", url: "https://moviedle.xyz/", desc: "Guess today's movie by exploring its cast, directors, genres and when it was released.", tags: ["Daily"] },
      { id: "cine2nerdle", name: "Cine2Nerdle", url: "https://www.cinenerdle2.app/", desc: "Movie equation puzzle", tags: ["Daily"] },
      { id: "framed", name: "Framed", url: "https://framed.wtf/", desc: "Guess the movie from a frame", tags: ["Daily"] },
      { id: "episode", name: "Episode", url: "https://episode.wtf/", desc: "Guess the TV episode from stills", tags: ["Daily"] },
      { id: "plotwords", name: "Plotwords", url: "https://plotwords.com/daily", desc: "Guess the name of the movie using as few plot keywords as possible!", tags: ["Daily"] },
      { id: "gaps", name: "Gaps", url: "https://gaps.wtf/", desc: "Guess the name of the movie!", tags: ["Daily"] },

      { id: "decipher", name: "Decipher", url: "https://decipher.wtf/", desc: "Decipher the hidden message", tags: ["Daily"] },
      { id: "spots", name: "Spots", url: "https://spots.wtf/", desc: "Your goal is to guess the secret 4-color code. There are 6 possible colors:", tags: ["Daily"] },
      { id: "spotle", name: "Spotle", url: "https://spotle.io/", desc: "10 guesses, 1000 artists. Will you win today?", tags: ["Daily"] },
      { id: "worldle", name: "Worldle", url: "https://worldle.teuteuf.fr/", desc: "Guess the territory", tags: ["Daily"] },

      { id: "wordle", name: "Wordle", url: "https://www.nytimes.com/games/wordle/index.html", desc: "Classic daily word puzzle", tags: ["Daily"] },
      { id: "connections", name: "Connections", url: "https://www.nytimes.com/games/connections", desc: "Create four groups of four!", tags: ["Daily"] },
      { id: "strands", name: "Strands", url: "https://www.nytimes.com/games/strands", desc: "Find hidden words and uncover the dayâ€™s theme.", tags: ["Daily"] },
      { id: "spellingbee", name: "Spelling Bee", url: "https://www.nytimes.com/puzzles/spelling-bee", desc: "Make words from a letter hive", tags: ["Daily"] },

      { id: "contexto", name: "Contexto", url: "https://contexto.me/", desc: "Find the secret word by similarity", tags: ["Daily"] },
      { id: "linkedIn", name: "LinkedIn Games", url: "https://www.linkedin.com/games/", desc: "Prep your mind for the workday and compare results.", tags: ["Daily"] },
    ];

    /***********************
     * 2) STAR STORAGE (per user)
     ***********************/
    const STAR_KEY = "ultimateDailyGames:stars:v2";

    function loadStars() {
      try {
        const raw = localStorage.getItem(STAR_KEY);
        const arr = raw ? JSON.parse(raw) : [];
        return Array.isArray(arr) ? arr : [];
      } catch {
        return [];
      }
    }

    function saveStars(starArray) {
      localStorage.setItem(STAR_KEY, JSON.stringify(starArray));
    }

    let stars = loadStars();

    /***********************
     * 3) CLICK TRACKING (per user)
     * - keeps BOTH:
     *   - completedToday: last click timestamp for *today*
     *   - lastPlayed: most recent click timestamp overall
     ***********************/
    const CLICK_KEY = "ultimateDailyGames:clicks:v2";

    function getTodayKey() {
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd}`;
    }

    function loadClicks() {
      try {
        const raw = localStorage.getItem(CLICK_KEY);
        const obj = raw ? JSON.parse(raw) : {};
        return (obj && typeof obj === "object") ? obj : {};
      } catch {
        return {};
      }
    }

    function saveClicks(clickObj) {
      localStorage.setItem(CLICK_KEY, JSON.stringify(clickObj));
    }

    // clicks[gameId] = { todayKey, todayTs, lastTs }
    let clicks = loadClicks();

    function markClicked(gameId) {
      const now = Date.now();
      const todayKey = getTodayKey();
      const prev = clicks[gameId] && typeof clicks[gameId] === "object" ? clicks[gameId] : {};
      clicks[gameId] = { ...prev, todayKey, todayTs: now, lastTs: now };
      saveClicks(clicks);
    }

    function isCompletedToday(gameId) {
      const todayKey = getTodayKey();
      return clicks?.[gameId]?.todayKey === todayKey;
    }

    function getLastPlayedTs(gameId) {
      return clicks?.[gameId]?.lastTs ?? 0;
    }

    function formatTime(ts) {
      if (!ts) return "";
      try {
        return new Date(ts).toLocaleTimeString([], { hour: "numeric", minute: "2-digit" });
      } catch { return ""; }
    }

    function formatDateTime(ts) {
      if (!ts) return "";
      try {
        const d = new Date(ts);
        const date = d.toLocaleDateString([], { year: "numeric", month: "short", day: "numeric" });
        const time = d.toLocaleTimeString([], { hour: "numeric", minute: "2-digit" });
        return `${date} â€¢ ${time}`;
      } catch { return ""; }
    }

    // Reset only "today" completion state (keeps lastTs)
    function resetToday() {
      const todayKey = getTodayKey();
      let changed = false;

      for (const [id, info] of Object.entries(clicks)) {
        if (!info || typeof info !== "object") continue;
        if (info.todayKey === todayKey) {
          const next = { ...info };
          delete next.todayKey;
          delete next.todayTs;
          clicks[id] = next;
          changed = true;
        }
      }

      if (changed) {
        saveClicks(clicks);
        render();
        toast("Reset today's completions");
      } else {
        toast("Nothing to reset");
      }
    }

    /***********************
     * 4) COMPLETED COLLAPSE STATE (minimized by default)
     ***********************/
    const COMPLETED_COLLAPSE_KEY = "ultimateDailyGames:completedCollapsed:v1";

    function loadCompletedCollapsed() {
      try {
        const raw = localStorage.getItem(COMPLETED_COLLAPSE_KEY);
        return raw === null ? true : raw === "1";
      } catch {
        return true;
      }
    }

    function saveCompletedCollapsed(isCollapsed) {
      localStorage.setItem(COMPLETED_COLLAPSE_KEY, isCollapsed ? "1" : "0");
    }

    /***********************
     * 5) SORTING + SEARCH
     ***********************/
    function normalize(s) {
      return (s || "").toLowerCase().trim();
    }

    function sortAZ(list) {
      return list.slice().sort((a,b) => a.name.localeCompare(b.name));
    }

    let query = "";

    function matchesQuery(game) {
      if (!query) return true;
      const last = getLastPlayedTs(game.id);
      const lastTxt = last ? ` last played ${formatDateTime(last)}` : "";
      const hay = normalize(`${game.name} ${game.desc || ""} ${(game.tags || []).join(" ")}${lastTxt}`);
      return hay.includes(query);
    }

    function gameById(id) {
      return GAMES.find(g => g.id === id) || null;
    }

    /***********************
     * 6) MIDNIGHT AUTO-RESET (rerender at local midnight)
     ***********************/
    function msUntilNextLocalMidnight() {
      const now = new Date();
      const next = new Date(now);
      next.setHours(24, 0, 0, 0);
      return next.getTime() - now.getTime();
    }

    let midnightTimer = null;
    function scheduleMidnightRerender() {
      clearTimeout(midnightTimer);
      midnightTimer = setTimeout(() => {
        render();
        scheduleMidnightRerender();
      }, msUntilNextLocalMidnight() + 50);
    }

    /***********************
     * 7) RENDERING
     ***********************/
    const sectionsEl = document.getElementById("sections");
    const searchInput = document.getElementById("searchInput");
    const clearStarsBtn = document.getElementById("clearStarsBtn");
    const exportBtn = document.getElementById("exportBtn");

    function buildSection({ title, icon, games }, { cardStyle = "normal", emptyText } = {}) {
      const container = document.createElement("section");
      container.className = "section";

      const header = document.createElement("div");
      header.className = "sectionHeader";

      const iconEl = document.createElement("div");
      iconEl.className = "icon";
      iconEl.textContent = icon || "ðŸŽ®";

      const titleEl = document.createElement("h2");
      titleEl.className = "sectionTitle";
      titleEl.textContent = title;

      header.appendChild(iconEl);
      header.appendChild(titleEl);

      const grid = document.createElement("div");
      grid.className = "grid";

      const filtered = games.filter(matchesQuery);

      for (const game of filtered) {
        grid.appendChild(buildCard(game, { cardStyle }));
      }

      const empty = document.createElement("div");
      empty.className = "empty";
      empty.textContent = emptyText || "No games match your search.";
      empty.style.display = filtered.length ? "none" : "block";

      container.appendChild(header);
      container.appendChild(grid);
      container.appendChild(empty);

      return container;
    }

    function buildCard(game, { cardStyle = "normal" } = {}) {
      const card = document.createElement("div");
      card.className = "gameCard";
      card.setAttribute("role", "link");
      card.setAttribute("tabindex", "0");
      card.setAttribute("aria-label", `Open ${game.name} in a new tab`);

      if (cardStyle === "starred") card.classList.add("starredCard");
      if (cardStyle === "completed") card.classList.add("completedCard");

      const left = document.createElement("div");
      left.className = "left";

      const nameRow = document.createElement("div");
      nameRow.className = "nameRow";

      const name = document.createElement("div");
      name.className = "gameName";
      name.textContent = game.name;

      nameRow.appendChild(name);

      if (game.tags && game.tags.length) {
        const tag = document.createElement("span");
        tag.className = "tag";
        tag.textContent = game.tags[0];
        nameRow.appendChild(tag);
      }

      const lastTs = getLastPlayedTs(game.id);
      if (lastTs) {
        const lastTag = document.createElement("span");
        lastTag.className = "tag";
        lastTag.textContent = `Last played: ${formatDateTime(lastTs)}`;
        nameRow.appendChild(lastTag);
      }

      if (cardStyle === "completed") {
        const todayTs = clicks?.[game.id]?.todayTs ?? 0;
        if (todayTs) {
          const todayTag = document.createElement("span");
          todayTag.className = "tag";
          todayTag.textContent = `Today: ${formatTime(todayTs)}`;
          nameRow.appendChild(todayTag);
        }
      }

      const desc = document.createElement("div");
      desc.className = "desc";
      desc.textContent = game.desc || "";

      left.appendChild(nameRow);
      left.appendChild(desc);

      const right = document.createElement("div");
      right.className = "right";

      const starBtn = document.createElement("button");
      starBtn.className = "iconBtn";
      starBtn.type = "button";

      const isStarred = stars.includes(game.id);
      if (isStarred) starBtn.classList.add("starred");

      starBtn.title = isStarred ? "Unstar" : "Star";
      starBtn.setAttribute("aria-label", starBtn.title);
      starBtn.textContent = isStarred ? "â­" : "â˜†";

      starBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggleStar(game.id);
      });

      right.appendChild(starBtn);

      card.appendChild(left);
      card.appendChild(right);

      card.addEventListener("click", (e) => {
        if (e.target.closest("button")) return;
        markClicked(game.id);
        render();
        window.open(game.url, "_blank", "noopener,noreferrer");
      });

      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          markClicked(game.id);
          render();
          window.open(game.url, "_blank", "noopener,noreferrer");
        }
      });

      return card;
    }

    function buildCompletedCollapsible(completedToday) {
      const collapsed = loadCompletedCollapsed();

      const details = document.createElement("details");
      details.className = "sectionDetails";
      details.open = !collapsed;

      const summary = document.createElement("summary");

      const summaryInner = document.createElement("div");
      summaryInner.className = "summaryInner";

      const left = document.createElement("div");
      left.className = "summaryTitle";

      const icon = document.createElement("div");
      icon.className = "icon";
      icon.textContent = "âœ…";

      const title = document.createElement("h2");
      title.textContent = "Completed (Today)";

      const countPill = document.createElement("span");
      countPill.className = "pill";
      countPill.textContent = `${completedToday.length} done`;

      left.appendChild(icon);
      left.appendChild(title);
      left.appendChild(countPill);

      const meta = document.createElement("div");
      meta.className = "summaryMeta";

      const resetBtn = document.createElement("button");
      resetBtn.type = "button";
      resetBtn.className = "resetBtn";
      resetBtn.title = "Clear today's completed list (keeps last played)";
      resetBtn.innerHTML = `<span aria-hidden="true">â†º</span><span>Reset today</span>`;
      resetBtn.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        resetToday();
      });

      const chev = document.createElement("span");
      chev.className = "chev";
      chev.setAttribute("aria-hidden", "true");
      chev.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      `;

      meta.appendChild(resetBtn);
      meta.appendChild(chev);

      summaryInner.appendChild(left);
      summaryInner.appendChild(meta);

      summary.appendChild(summaryInner);
      details.appendChild(summary);

      const body = buildSection(
        { title: "", icon: "", games: completedToday },
        { cardStyle: "completed", emptyText: "No completed games match your search." }
      );
      body.classList.add("detailsBody");
      body.querySelector(".sectionHeader")?.remove();

      details.appendChild(body);

      details.addEventListener("toggle", () => {
        saveCompletedCollapsed(!details.open);
      });

      return details;
    }

    function render() {
      sectionsEl.innerHTML = "";

      const allSorted = sortAZ(GAMES);

      const completedToday = allSorted
        .filter(g => isCompletedToday(g.id))
        .sort((a, b) => (clicks?.[b.id]?.todayTs ?? 0) - (clicks?.[a.id]?.todayTs ?? 0))
        .filter(matchesQuery);

      sectionsEl.appendChild(buildCompletedCollapsible(completedToday));

      if (SHOW_STARRED_SECTION) {
        const starredInStarOrder = stars
          .map(id => gameById(id))
          .filter(Boolean)
          .filter(g => !isCompletedToday(g.id))
          .filter(matchesQuery);

        if (starredInStarOrder.length) {
          sectionsEl.appendChild(
            buildSection(
              { title: "Starred", icon: "â­", games: starredInStarOrder },
              { cardStyle: "starred", emptyText: "No starred games match your search." }
            )
          );
        }
      }

      const remaining = allSorted
        .filter(g => !isCompletedToday(g.id))
        .filter(matchesQuery);

      sectionsEl.appendChild(
        buildSection(
          { title: "All Games (Aâ€“Z)", icon: "ðŸŽ®", games: remaining },
          { cardStyle: "normal", emptyText: "No games match your search." }
        )
      );
    }

    /***********************
     * 8) INTERACTIONS
     ***********************/
    function toggleStar(gameId) {
      const idx = stars.indexOf(gameId);

      if (idx !== -1) {
        stars.splice(idx, 1);
        toast("Unstarred");
      } else {
        stars.push(gameId);
        toast("Starred");
      }

      saveStars(stars);
      render();
    }

    searchInput.addEventListener("input", () => {
      query = normalize(searchInput.value);
      render();
    });

    clearStarsBtn.addEventListener("click", () => {
      stars = [];
      saveStars(stars);
      render();
      toast("Cleared stars");
    });

    exportBtn.addEventListener("click", async () => {
      const starredInStarOrder = stars
        .map(id => GAMES.find(g => g.id === id))
        .filter(Boolean);

      const lines = starredInStarOrder.map(g => `${g.name} â€” ${g.url}`);

      const text =
        lines.length
          ? `My starred games:\n\n${lines.join("\n")}\n`
          : "No starred games yet.";

      try {
        await navigator.clipboard.writeText(text);
        toast("Copied stars");
      } catch {
        window.prompt("Copy your starred list:", text);
      }
    });

    const themeToggleBtn = document.getElementById("themeToggle");
    themeToggleBtn.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-theme") || getPreferredTheme();
      const next = current === "dark" ? "light" : "dark";
      applyTheme(next);
      setCookie(THEME_COOKIE, next, 365);
      toast(next === "dark" ? "Dark mode" : "Light mode");
    });

    /***********************
     * 9) TOAST
     ***********************/
    const toastEl = document.getElementById("toast");
    const toastText = document.getElementById("toastText");
    let toastTimer = null;

    function toast(message) {
      toastText.textContent = message;
      toastEl.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toastEl.classList.remove("show"), 1400);
    }

    /***********************
     * INIT
     ***********************/
    // Show version in footer
    const versionEl = document.getElementById("versionText");
    if (versionEl) versionEl.textContent = `Version ${VERSION}`;

    applyTheme(getPreferredTheme());
    render();
    scheduleMidnightRerender();
  </script>
</body>
</html>
